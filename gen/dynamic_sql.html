<!DOCTYPE html>
<html lang="en">
<head prefix="og: http://ogp.me/ns#">
  <meta charset="utf-8">
  <title>Gen Dynamic SQL | GORM - The fantastic ORM library for Golang, aims to be developer friendly.</title>
  <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- Canonical links -->
  <link rel="canonical" href="http://gorm.io/gen/dynamic_sql.html">
  <!-- Alternative links -->
  
    
      <link rel="alternative" hreflang="en" href="http://gorm.io/gen/dynamic_sql.html">
    
      <link rel="alternative" hreflang="zh_CN" href="http://gorm.io/zh_CN/gen/dynamic_sql.html">
    
      <link rel="alternative" hreflang="de_DE" href="http://gorm.io/de_DE/gen/dynamic_sql.html">
    
      <link rel="alternative" hreflang="es_ES" href="http://gorm.io/es_ES/gen/dynamic_sql.html">
    
      <link rel="alternative" hreflang="id_ID" href="http://gorm.io/id_ID/gen/dynamic_sql.html">
    
      <link rel="alternative" hreflang="it_IT" href="http://gorm.io/it_IT/gen/dynamic_sql.html">
    
      <link rel="alternative" hreflang="ja_JP" href="http://gorm.io/ja_JP/gen/dynamic_sql.html">
    
      <link rel="alternative" hreflang="ru_RU" href="http://gorm.io/ru_RU/gen/dynamic_sql.html">
    
      <link rel="alternative" hreflang="fr_FR" href="http://gorm.io/fr_FR/gen/dynamic_sql.html">
    
      <link rel="alternative" hreflang="ko_KR" href="http://gorm.io/ko_KR/gen/dynamic_sql.html">
    
  
  <!-- Icon -->
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
  <link rel="manifest" href="/site.webmanifest">
  <!-- CSS -->
  <!-- build:css build/css/navy.css -->
  
<link rel="stylesheet" href="/css/navy.css">

  <!-- endbuild -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.css" />
  <!-- RSS -->
  <link rel="alternate" href="/atom.xml" title="GORM" type="application/atom+xml">
  <!-- Open Graph -->
  <meta name="description" content="DIY methodMethod interfaceThe DIY method needs to be defined through the interface. In the method, the specific SQL query logic is described in the way of comments. Simple WHERE queries can be wrapped">
<meta property="og:type" content="website">
<meta property="og:title" content="Gen Dynamic SQL">
<meta property="og:url" content="http://gorm.io/gen/dynamic_sql.html">
<meta property="og:site_name" content="GORM">
<meta property="og:description" content="DIY methodMethod interfaceThe DIY method needs to be defined through the interface. In the method, the specific SQL query logic is described in the way of comments. Simple WHERE queries can be wrapped">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2022-09-14T09:01:07.770Z">
<meta property="article:modified_time" content="2022-09-14T09:01:07.770Z">
<meta property="article:author" content="Jinzhu">
<meta name="twitter:card" content="summary">
<meta name="twitter:site" content="zhangjinzhu">
  <!-- Google Tag Manager -->
  
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-WSNPD75');</script>


<meta name="generator" content="Hexo 6.2.0"></head>

<body>
  <div id="container">
    <header id="header" class="wrapper">
  <div id="header-inner" class="inner">
    <h1 id="logo-wrap">
      <a href="/" id="logo">GORM</a>
    </h1>
    <nav id="main-nav">
      <a href="/docs/" class="main-nav-link"><i class="fa fa-book"></i>Docs</a><a href="/community.html" class="main-nav-link"><i class="fab fa-slack"></i>Community</a><a href="https://pkg.go.dev/gorm.io/gorm" class="main-nav-link" target="_blank"><i class="fa fa-cogs"></i>API</a><a href="/contribute.html" class="main-nav-link"><i class="fa fa-rocket"></i>Contribute</a>
      <div id="search-input-wrap">
        <div id="search-input-icon">
          <i class="fa fa-search"></i>
        </div>
        <input type="search" id="search-input" placeholder="Search documents...">
      </div>
    </nav>
    <div id="lang-select-wrap">
      <label id="lang-select-label"><i class="fa fa-globe"></i><span>English</span></label>
      <select id="lang-select" data-canonical="">
        
          <option value="en" selected>English</option>
        
          <option value="zh_CN">简体中文</option>
        
          <option value="de_DE">Deutsch</option>
        
          <option value="es_ES">Español</option>
        
          <option value="id_ID">bahasa Indonesia</option>
        
          <option value="it_IT">Italiano</option>
        
          <option value="ja_JP">日本語</option>
        
          <option value="ru_RU">Русский</option>
        
          <option value="fr_FR">French</option>
        
          <option value="ko_KR">한국어</option>
        
      </select>
    </div>
    <a id="mobile-nav-toggle">
      <span class="mobile-nav-toggle-bar"></span>
      <span class="mobile-nav-toggle-bar"></span>
      <span class="mobile-nav-toggle-bar"></span>
    </a>
  </div>
</header>

    <div id="content-wrap">
  <div id="content" class="wrapper">
    <div id="content-inner">
      <article class="article-container" itemscope itemtype="http://schema.org/Article">
        <div class="article-inner">
          <div class="article">
            <div class="inner">
              <header class="article-header">
                <h1 class="article-title" itemprop="name">Gen Dynamic SQL</h1>
                
                <a target="_blank" rel="noopener" href="https://github.com/go-gorm/gorm.io/edit/master/pages/gen/dynamic_sql.md" class="article-edit-link" title="Improve this page"><i class="fa fa-pencil"></i></a>
                
              </header>
              <div class="article-content" itemprop="articleBody">
                <html><head></head><body><h3 id="DIY-method" class="article-heading"><a href="#DIY-method" class="headerlink" title="DIY method"></a>DIY method<a class="article-anchor" href="#DIY-method" aria-hidden="true"></a></h3><h4 id="Method-interface" class="article-heading"><a href="#Method-interface" class="headerlink" title="Method interface"></a>Method interface<a class="article-anchor" href="#Method-interface" aria-hidden="true"></a></h4><p>The DIY method needs to be defined through the interface. In the method, the specific SQL query logic is described in the way of comments. Simple WHERE queries can be wrapped in <code>where()</code>. When using complex queries, you need to write complete SQL. You can directly wrap them in <code>sql()</code> or write SQL directly. If there are some comments on the method, just add a blank line comment in the middle.</p>
<figure class="highlight go"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">type</span> Method <span class="keyword">interface</span> {</span><br><span class="line">    <span class="comment">// where("name=@name and age=@age")</span></span><br><span class="line">    SimpleFindByNameAndAge(name <span class="type">string</span>, age <span class="type">int</span>) (gen.T, <span class="type">error</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// FindUserToMap query by id and return id-&gt;instance</span></span><br><span class="line">    <span class="comment">// </span></span><br><span class="line">    <span class="comment">// sql(select * from users where id=@id)</span></span><br><span class="line">    FindUserToMap(id <span class="type">int</span>) (gen.M, <span class="type">error</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// InsertValue insert into users (name,age) values (@name,@age)</span></span><br><span class="line">    InsertValue(age <span class="type">int</span>, name <span class="type">string</span>) <span class="type">error</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>Method input parameters and return values support basic types (<code>int</code>, <code>string</code>, <code>bool</code>…), struct and placeholders (<code>gen.T</code>/<code>gen.M</code>/<code>gen.RowsAffected</code>), and types support pointers and arrays. The return value is at most a value and an error.</p>
<p>Usage(complete case on <a href="#quick-start">Quick start</a>):</p>
<figure class="highlight go"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">// implement model.Method on table "user" and "comany"</span></span><br><span class="line">g.ApplyInterface(<span class="function"><span class="keyword">func</span><span class="params">(method model.Method)</span></span> {}, model.User{}, g.GenerateModel(<span class="string">"company"</span>))</span><br></pre></td></tr></tbody></table></figure>

<h5 id="Syntax-of-template" class="article-heading"><a href="#Syntax-of-template" class="headerlink" title="Syntax of template"></a>Syntax of template<a class="article-anchor" href="#Syntax-of-template" aria-hidden="true"></a></h5><h6 id="placeholder" class="article-heading"><a href="#placeholder" class="headerlink" title="placeholder"></a>placeholder<a class="article-anchor" href="#placeholder" aria-hidden="true"></a></h6><ul>
<li><code>gen.T</code> represents specified <code>struct</code> or <code>table</code></li>
<li><code>gen.M</code> represents <code>map[string]interface</code></li>
<li><code>gen.RowsAffected</code> represents SQL executed <code>rowsAffected</code> (type:int64)</li>
<li><code>@@table</code>  represents table’s name (if method’s parameter doesn’t contains variable <code>table</code>, GEN will generate <code>table</code> from model struct)</li>
<li><code>@@&lt;columnName&gt;</code> represents column’s name or table’s name</li>
<li><code>@&lt;name&gt;</code> represents normal query variable</li>
</ul>
<h6 id="template" class="article-heading"><a href="#template" class="headerlink" title="template"></a>template<a class="article-anchor" href="#template" aria-hidden="true"></a></h6><p>Logical operations must be wrapped in <code>{{}}</code>,and end must used <code>{{end}}</code>, All templates support nesting</p>
<ul>
<li><code>if</code>/<code>else if</code>/<code>else</code> the condition accept a bool parameter or operation expression which conforms to Golang syntax.</li>
<li><code>where</code> The <code>where</code> clause will be inserted only if the child elements return something. The key word  <code>and</code> or <code>or</code>  in front of clause will be removed. And <code>and</code> will be added automatically when there is no junction keyword between query condition clause.</li>
<li><code>Set</code> The  <code>set</code> clause will be inserted only if the child elements return something. The <code>,</code> in front of columns array will be removed.And <code>,</code> will be added automatically when there is no junction keyword between query coulmns.</li>
<li><code>for</code> The  <code>for</code> clause traverses an array according to golang syntax and inserts its contents into SQL,supports array of struct.</li>
<li><code>...</code> Coming soon</li>
</ul>
<h6 id="If-clause" class="article-heading"><a href="#If-clause" class="headerlink" title="If clause"></a><code>If</code> clause<a class="article-anchor" href="#If-clause" aria-hidden="true"></a></h6><figure class="highlight awk"><table><tbody><tr><td class="code"><pre><span class="line">{{<span class="keyword">if</span> cond1}}</span><br><span class="line">    <span class="regexp">//</span> <span class="keyword">do</span> something here</span><br><span class="line">{{<span class="keyword">else</span> <span class="keyword">if</span> cond2}}</span><br><span class="line">    <span class="regexp">//</span> <span class="keyword">do</span> something here</span><br><span class="line">{{<span class="keyword">else</span>}}</span><br><span class="line">    <span class="regexp">//</span> <span class="keyword">do</span> something here</span><br><span class="line">{{end}}</span><br></pre></td></tr></tbody></table></figure>

<p>Use case in raw SQL:</p>
<figure class="highlight go"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">// select * from users where </span></span><br><span class="line"><span class="comment">//  {{if name !=""}} </span></span><br><span class="line"><span class="comment">//      name=@name</span></span><br><span class="line"><span class="comment">//  {{end}}</span></span><br><span class="line">methond(name <span class="type">string</span>) (gen.T,<span class="type">error</span>)</span><br></pre></td></tr></tbody></table></figure>

<p>Use case in raw SQL template:</p>
<figure class="highlight handlebars"><table><tbody><tr><td class="code"><pre><span class="line"><span class="language-xml">select * from @@table where</span></span><br><span class="line"><span class="language-xml"></span><span class="template-variable">{{<span class="name"><span class="built_in">if</span></span> age&gt;<span class="number">60</span>}}</span><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">    status="older"</span></span><br><span class="line"><span class="language-xml"></span><span class="template-tag">{{<span class="keyword">else</span> <span class="keyword">if</span> age&gt;30}}</span><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">    status="middle-ager"</span></span><br><span class="line"><span class="language-xml"></span><span class="template-tag">{{<span class="keyword">else</span> <span class="keyword">if</span> age&gt;18}}</span><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">    status="younger"</span></span><br><span class="line"><span class="language-xml"></span><span class="template-tag">{{<span class="keyword">else</span>}}</span><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">    </span><span class="template-variable">{{<span class="name"><span class="built_in">if</span></span> <span class="attr">sex</span>==<span class="string">"male"</span>}}</span><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">        status="boys"</span></span><br><span class="line"><span class="language-xml">    </span><span class="template-tag">{{<span class="keyword">else</span>}}</span><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">        status="girls"</span></span><br><span class="line"><span class="language-xml">    </span><span class="template-variable">{{<span class="name">end</span>}}</span><span class="language-xml"></span></span><br><span class="line"><span class="language-xml"></span><span class="template-variable">{{<span class="name">end</span>}}</span></span><br></pre></td></tr></tbody></table></figure>

<h6 id="Where-clause" class="article-heading"><a href="#Where-clause" class="headerlink" title="Where clause"></a><code>Where</code> clause<a class="article-anchor" href="#Where-clause" aria-hidden="true"></a></h6><figure class="highlight handlebars"><table><tbody><tr><td class="code"><pre><span class="line"><span class="template-variable">{{<span class="name">where</span>}}</span><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">    // do something here</span></span><br><span class="line"><span class="language-xml"></span><span class="template-variable">{{<span class="name">end</span>}}</span></span><br></pre></td></tr></tbody></table></figure>

<p>Use case in raw SQL</p>
<figure class="highlight go"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">// select * from </span></span><br><span class="line"><span class="comment">//  {{where}}</span></span><br><span class="line"><span class="comment">//      id=@id</span></span><br><span class="line"><span class="comment">//  {{end}}</span></span><br><span class="line">methond(id <span class="type">int</span>) <span class="type">error</span></span><br></pre></td></tr></tbody></table></figure>

<p>Use case in raw SQL template</p>
<figure class="highlight handlebars"><table><tbody><tr><td class="code"><pre><span class="line"><span class="language-xml">select * from @@table </span></span><br><span class="line"><span class="language-xml"></span><span class="template-variable">{{<span class="name">where</span>}}</span><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">    </span><span class="template-variable">{{<span class="name"><span class="built_in">if</span></span> cond}}</span><span class="language-xml"> id=@id, </span><span class="template-variable">{{<span class="name">end</span>}}</span><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">    </span><span class="template-variable">{{<span class="name"><span class="built_in">if</span></span> name != <span class="string">""</span>}}</span><span class="language-xml"> @@key=@value, </span><span class="template-variable">{{<span class="name">end</span>}}</span><span class="language-xml"></span></span><br><span class="line"><span class="language-xml"></span><span class="template-variable">{{<span class="name">end</span>}}</span></span><br></pre></td></tr></tbody></table></figure>

<h6 id="Set-clause" class="article-heading"><a href="#Set-clause" class="headerlink" title="Set clause"></a><code>Set</code> clause<a class="article-anchor" href="#Set-clause" aria-hidden="true"></a></h6><figure class="highlight handlebars"><table><tbody><tr><td class="code"><pre><span class="line"><span class="template-variable">{{<span class="name">set</span>}}</span><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">    // sepecify update expression here</span></span><br><span class="line"><span class="language-xml"></span><span class="template-variable">{{<span class="name">end</span>}}</span></span><br></pre></td></tr></tbody></table></figure>

<p>Use case in raw SQL</p>
<figure class="highlight go"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">// update users </span></span><br><span class="line"><span class="comment">//  {{set}}</span></span><br><span class="line"><span class="comment">//      name=@name</span></span><br><span class="line"><span class="comment">//  {{end}}</span></span><br><span class="line"><span class="comment">// where id=@id</span></span><br><span class="line">methond(name <span class="type">string</span>,id <span class="type">int</span>) <span class="type">error</span></span><br></pre></td></tr></tbody></table></figure>

<p>Use case in raw SQL template</p>
<figure class="highlight handlebars"><table><tbody><tr><td class="code"><pre><span class="line"><span class="language-xml">update @@table </span></span><br><span class="line"><span class="language-xml"></span><span class="template-variable">{{<span class="name">set</span>}}</span><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">    </span><span class="template-variable">{{<span class="name"><span class="built_in">if</span></span> name!=<span class="string">""</span>}}</span><span class="language-xml"> name=@name </span><span class="template-variable">{{<span class="name">end</span>}}</span><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">    </span><span class="template-variable">{{<span class="name"><span class="built_in">if</span></span> age&gt;<span class="number">0</span>}}</span><span class="language-xml"> age=@age </span><span class="template-variable">{{<span class="name">end</span>}}</span><span class="language-xml"></span></span><br><span class="line"><span class="language-xml"></span><span class="template-variable">{{<span class="name">end</span>}}</span><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">where id=@id</span></span><br></pre></td></tr></tbody></table></figure>
<h6 id="For-clause" class="article-heading"><a href="#For-clause" class="headerlink" title="For clause"></a><code>For</code> clause<a class="article-anchor" href="#For-clause" aria-hidden="true"></a></h6><figure class="highlight handlebars"><table><tbody><tr><td class="code"><pre><span class="line"><span class="template-variable">{{<span class="name">for</span> _,<span class="attr">name:</span>=range names}}</span><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">    // do something here</span></span><br><span class="line"><span class="language-xml"></span><span class="template-variable">{{<span class="name">end</span>}}</span></span><br></pre></td></tr></tbody></table></figure>

<p>Use case in raw SQL:</p>
<figure class="highlight go"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">// select * from users where id&gt;0 </span></span><br><span class="line"><span class="comment">//  {{for _,name:=range names}} </span></span><br><span class="line"><span class="comment">//      and name=@name</span></span><br><span class="line"><span class="comment">//  {{end}}</span></span><br><span class="line">methond(names []<span class="type">string</span>) (gen.T,<span class="type">error</span>) </span><br></pre></td></tr></tbody></table></figure>

<p>Use case in raw SQL template:</p>
<figure class="highlight handlebars"><table><tbody><tr><td class="code"><pre><span class="line"><span class="language-xml">select * from @@table where</span></span><br><span class="line"><span class="language-xml">  </span><span class="template-variable">{{<span class="name">for</span> index,<span class="attr">name:</span>=range names}}</span><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">     </span><span class="template-variable">{{<span class="name"><span class="built_in">if</span></span> index &gt;<span class="number">0</span>}}</span><span class="language-xml"> </span></span><br><span class="line"><span class="language-xml">        OR</span></span><br><span class="line"><span class="language-xml">     </span><span class="template-variable">{{<span class="name">end</span>}}</span><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">     name=@name</span></span><br><span class="line"><span class="language-xml">  </span><span class="template-variable">{{<span class="name">end</span>}}</span></span><br></pre></td></tr></tbody></table></figure>

<h5 id="Method-interface-example" class="article-heading"><a href="#Method-interface-example" class="headerlink" title="Method interface example"></a>Method interface example<a class="article-anchor" href="#Method-interface-example" aria-hidden="true"></a></h5><figure class="highlight go"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">type</span> Method <span class="keyword">interface</span> {</span><br><span class="line">    <span class="comment">// Where("name=@name and age=@age")</span></span><br><span class="line">    SimpleFindByNameAndAge(name <span class="type">string</span>, age <span class="type">int</span>) (gen.T, <span class="type">error</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// select * from users where id=@id</span></span><br><span class="line">    FindUserToMap(id <span class="type">int</span>) (gen.M, <span class="type">error</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// sql(insert into @@table (name,age) values (@name,@age) )</span></span><br><span class="line">    InsertValue(age <span class="type">int</span>, name <span class="type">string</span>) <span class="type">error</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// select name from @@table where id=@id</span></span><br><span class="line">    FindNameByID(id <span class="type">int</span>) <span class="type">string</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// select * from @@table</span></span><br><span class="line">    <span class="comment">//  {{where}}</span></span><br><span class="line">    <span class="comment">//      id&gt;0</span></span><br><span class="line">    <span class="comment">//      {{if cond}}id=@id {{end}}</span></span><br><span class="line">    <span class="comment">//      {{if key!="" &amp;&amp; value != ""}} or @@key=@value{{end}}</span></span><br><span class="line">    <span class="comment">//  {{end}}</span></span><br><span class="line">    FindByIDOrCustom(cond <span class="type">bool</span>, id <span class="type">int</span>, key, value <span class="type">string</span>) ([]gen.T, <span class="type">error</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// update @@table</span></span><br><span class="line">    <span class="comment">//  {{set}}</span></span><br><span class="line">    <span class="comment">//      update_time=now()</span></span><br><span class="line">    <span class="comment">//      {{if name != ""}}</span></span><br><span class="line">    <span class="comment">//          name=@name</span></span><br><span class="line">    <span class="comment">//      {{end}}</span></span><br><span class="line">    <span class="comment">//  {{end}}</span></span><br><span class="line">    <span class="comment">//  {{where}}</span></span><br><span class="line">    <span class="comment">//      id=@id</span></span><br><span class="line">    <span class="comment">//  {{end}}</span></span><br><span class="line">    UpdateName(name <span class="type">string</span>, id <span class="type">int</span>) (gen.RowsAffected,<span class="type">error</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// select * from @@table</span></span><br><span class="line">    <span class="comment">//  {{where}}</span></span><br><span class="line">    <span class="comment">//      {{for _,user:=range users}}</span></span><br><span class="line">    <span class="comment">//          {{if user.Age &gt;18}</span></span><br><span class="line">    <span class="comment">//              OR name=@user.Name </span></span><br><span class="line">    <span class="comment">//         {{end}}</span></span><br><span class="line">    <span class="comment">//      {{end}}</span></span><br><span class="line">    <span class="comment">//  {{end}}</span></span><br><span class="line">    FindByOrList(users []gen.T) ([]gen.T, <span class="type">error</span>)</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h4 id="Unit-Test" class="article-heading"><a href="#Unit-Test" class="headerlink" title="Unit Test"></a>Unit Test<a class="article-anchor" href="#Unit-Test" aria-hidden="true"></a></h4><p>Unit test file will be generated if <code>WithUnitTest</code> is set, which will generate unit test for general query function.</p>
<p>Unit test for DIY method need diy testcase, which should place in the same package with test file.</p>
<p>A testcase contains input and expectation result, input should match the method arguments, expectation should match method return values, which will be asserted <strong>Equal</strong> in test.</p>
<figure class="highlight go"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> query</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Input <span class="keyword">struct</span> {</span><br><span class="line">  Args []<span class="keyword">interface</span>{}</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Expectation <span class="keyword">struct</span> {</span><br><span class="line">  Ret []<span class="keyword">interface</span>{}</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> TestCase <span class="keyword">struct</span> {</span><br><span class="line">  Input</span><br><span class="line">  Expectation</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">/* Table student */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> StudentFindByIdTestCase = []TestCase {</span><br><span class="line">  {</span><br><span class="line">    Input{[]<span class="keyword">interface</span>{}{<span class="number">1</span>}},</span><br><span class="line">    Expectation{[]<span class="keyword">interface</span>{}{<span class="literal">nil</span>, <span class="literal">nil</span>}},</span><br><span class="line">  },</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>Corresponding test</p>
<figure class="highlight go"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">//FindById select * from @@table where id = @id</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s studentDo)</span></span> FindById(id <span class="type">int64</span>) (result *model.Student, err <span class="type">error</span>) {</span><br><span class="line">    <span class="comment">///</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Test_student_FindById</span><span class="params">(t *testing.T)</span></span> {</span><br><span class="line">    student := newStudent(db)</span><br><span class="line">    do := student.WithContext(context.Background()).Debug()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i, tt := <span class="keyword">range</span> StudentFindByIdTestCase {</span><br><span class="line">        t.Run(<span class="string">"FindById_"</span>+strconv.Itoa(i), <span class="function"><span class="keyword">func</span><span class="params">(t *testing.T)</span></span> {</span><br><span class="line">            res1, res2 := do.FindById(tt.Input.Args[<span class="number">0</span>].(<span class="type">int64</span>))</span><br><span class="line">            assert(t, <span class="string">"FindById"</span>, res1, tt.Expectation.Ret[<span class="number">0</span>])</span><br><span class="line">            assert(t, <span class="string">"FindById"</span>, res2, tt.Expectation.Ret[<span class="number">1</span>])</span><br><span class="line">        })</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h4 id="Smart-select-fields" class="article-heading"><a href="#Smart-select-fields" class="headerlink" title="Smart select fields"></a>Smart select fields<a class="article-anchor" href="#Smart-select-fields" aria-hidden="true"></a></h4><p>GEN allows select specific fields with <code>Select</code>, if you often use this in your application, maybe you want to define a smaller struct for API usage which can select specific fields automatically, for example:</p>
<figure class="highlight go"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">type</span> User <span class="keyword">struct</span> {</span><br><span class="line">  ID     <span class="type">uint</span></span><br><span class="line">  Name   <span class="type">string</span></span><br><span class="line">  Age    <span class="type">int</span></span><br><span class="line">  Gender <span class="type">string</span></span><br><span class="line">  <span class="comment">// hundreds of fields</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> APIUser <span class="keyword">struct</span> {</span><br><span class="line">  ID   <span class="type">uint</span></span><br><span class="line">  Name <span class="type">string</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Method <span class="keyword">interface</span>{</span><br><span class="line">    <span class="comment">// select * from user</span></span><br><span class="line">    FindSome() ([]APIUser, <span class="type">error</span>)</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">apiusers, err := u.WithContext(ctx).Limit(<span class="number">10</span>).FindSome()</span><br><span class="line"><span class="comment">// SELECT `id`, `name` FROM `users` LIMIT 10</span></span><br></pre></td></tr></tbody></table></figure>

</body></html>
              </div>

              

              <footer class="article-footer">
                <time class="article-footer-updated" datetime="2022-09-14T09:01:07.770Z" itemprop="dateModified">Last updated: 2022-09-14</time>
<a href="type_safe_sql.html" class="article-footer-prev" title="Overview"><i class="fa fa-chevron-left"></i><span>Prev</span></a><a href="database_to_structs.html" class="article-footer-next" title="Overview"><span>Next</span><i class="fa fa-chevron-right"></i></a>
              </footer>

              <div class="post_sponsors">
                <div class="sponsors-wrapper-pc open-collective-sponsors">
  <div class="inner">
    <div class="sponsors">
      <h1>Platinum Sponsors <i class="far fa-kiss-wink-heart"></i></h1>
      <!-- <div class="sponsor_item"> -->
      <!--   <a href="https://chainlinklabs.com" target="_blank" rel="sponsored noopener"> -->
      <!--     <img src="/sponsors-imgs/chainlink.png" alt="chainlink"> -->
      <!--   </a> -->
      <!-- </div> -->
      <div class="sponsor_item" title="Help to deliver a better GORM!">
        <a class="become-sponsor" href="/contribute.html#Donations">Become a Sponsor!</a>
      </div>
    </div>

    <div class="sponsors">
      <h1>Gold Sponsors <i class="far fa-kiss-wink-heart"></i></h1>
      <div class="sponsor_item">
        <a href="https://hubuc.com" target="_blank" rel="sponsored noopener" title="hubuc">
          <img src="/sponsors-imgs/hubuc.svg" alt="hubuc">
        </a>
      </div>
      <div class="sponsor_item">
        <a href="https://www.bytebase.com/?utm_source=github&utm_medium=github-gorm-sponsor-logo&utm_campaign=gorm-20220715" target="_blank" rel="sponsored noopener" title="bytebase">
          <img src="/sponsors-imgs/bytebase.png" alt="bytebase">
        </a>
      </div>

      <div class="sponsor_item" title="Help to deliver a better GORM!">
        <a class="become-sponsor" href="/contribute.html#Donations">Become a Sponsor!</a>
      </div>

      
    </div>
  </div>
</div>

<div class="sponsors-wrapper-mobile open-collective-sponsors">
  <div class="inner">
    <div class="sponsors">
      <h1>Platinum Sponsors</h1>
      <!-- <div class="sponsor_item"> -->
      <!--   <a href="https://chainlinklabs.com" target="_blank" rel="sponsored noopener"> -->
      <!--     <img src="/sponsors-imgs/chainlink.png" alt="chainlink"> -->
      <!--   </a> -->
      <!-- </div> -->
      <div class="sponsor_item" title="Help to deliver a better GORM!">
        <a class="become-sponsor" href="/contribute.html#Donations">Become a Sponsor!</a>
      </div>
    </div>

    <div class="sponsors">
      <h1>Gold Sponsors</h1>
      <div class="sponsor_item">
        <a href="https://chainlinklabs.com" target="_blank" rel="sponsored noopener" title="hubuc">
          <img src="/sponsors-imgs/hubuc.svg" alt="hubuc">
        </a>
      </div>
      <div class="sponsor_item">
        <a href="https://www.bytebase.com/?utm_source=github&utm_medium=github-gorm-sponsor-logo&utm_campaign=gorm-20220715" target="_blank" rel="sponsored noopener" title="bytebase">
          <img src="/sponsors-imgs/bytebase.png" alt="bytebase">
        </a>
      </div>

      <div class="sponsor_item" title="Help to deliver a better GORM!">
        <a class="become-sponsor" href="/contribute.html#Donations">Become a Sponsor!</a>
      </div>
    </div>
  </div>
</div>

              </div>

              <!--  -->
<!-- <section id="comments"> -->
<!-- <div id="disqus_thread"></div> -->
<!-- </sction> -->

<!-- <script> -->
<!-- var disqus_config = function () { -->
<!-- this.page.url = 'http://gorm.io/gen/dynamic_sql.html'; -->
<!-- this.page.identifier = 'http://gorm.io/gen/dynamic_sql.html'; -->
<!-- this.language = 'en'; -->
<!-- }; -->

<!-- (function() { // DON'T EDIT BELOW THIS LINE -->
<!-- var d = document, s = d.createElement('script'); -->
<!-- s.src = 'https://gormv2.disqus.com/embed.js'; -->
<!-- s.setAttribute('data-timestamp', +new Date()); -->
<!-- (d.head || d.body).appendChild(s); -->
<!-- })(); -->
<!-- </script> -->
<!--  -->

            </div>
          </div>
          <aside id="article-toc" role="navigation">
            <div id="article-toc-inner">
              <div id="sidebar-ad-wrapper" class="tagmanager_ad"></div>
              <strong class="sidebar-title">Contents</strong>
              <ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#DIY-method"><span class="toc-text">DIY method</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Method-interface"><span class="toc-text">Method interface</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#Syntax-of-template"><span class="toc-text">Syntax of template</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#placeholder"><span class="toc-text">placeholder</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#template"><span class="toc-text">template</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#If-clause"><span class="toc-text">If clause</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#Where-clause"><span class="toc-text">Where clause</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#Set-clause"><span class="toc-text">Set clause</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#For-clause"><span class="toc-text">For clause</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Method-interface-example"><span class="toc-text">Method interface example</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Unit-Test"><span class="toc-text">Unit Test</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Smart-select-fields"><span class="toc-text">Smart select fields</span></a></li></ol></li></ol>

              
                <a href="https://github.com/go-gorm/gorm.io/edit/master/pages/gen/dynamic_sql.md" target="_blank" id="article-improve">
                  Improve this page
                </a>
              
              <a href="#" id="article-toc-top">Back to Top</a>
            </div>
          </aside>
        </div>
      </article>
      <aside id="sidebar" role="navigation">
  <div class="inner">
    <strong class="sidebar-title">Getting Started</strong><a href="index.html" class="sidebar-link">Overview</a><strong class="sidebar-title">Dao Generator</strong><a href="dao.html" class="sidebar-link">Overview</a><a href="create.html" class="sidebar-link">Create</a><a href="update.html" class="sidebar-link">Update</a><a href="query.html" class="sidebar-link">Query</a><a href="delete.html" class="sidebar-link">Delete</a><a href="associations.html" class="sidebar-link">Associations</a><strong class="sidebar-title">Type-Safe Compiled SQL</strong><a href="type_safe_sql.html" class="sidebar-link">Overview</a><a href="dynamic_sql.html" class="sidebar-link current">Dynamic SQL</a><strong class="sidebar-title">Database To Structs</strong><a href="database_to_structs.html" class="sidebar-link">Overview</a><a href="fields.html" class="sidebar-link">Fields</a><a href="methods.html" class="sidebar-link">Methods</a><strong class="sidebar-title">Advanced Topics</strong><a href="clause.html" class="sidebar-link">GORM Clause</a><a href="transaction.html" class="sidebar-link">Transaction</a><a href="plugins.html" class="sidebar-link">GORM Plugins</a>
  </div>
</aside>

    </div>
  </div>
</div>

    <footer id="footer" class="wrapper">
  <div class="inner">
    <div id="footer-copyright">
      &copy; 2013~2022 <a href="https://github.com/jinzhu" target="_blank">Jinzhu</a><br>
      Documentation licensed under <a href="http://creativecommons.org/licenses/by/4.0/" target="_blank">CC BY 4.0</a>.<br>
      <div id="gorm.cn" style="display:none">
      感谢 <a href="https://www.qiniu.com/" target="_blank">七牛云</a> 对 CDN 的赞助，<a href="https://github.com/unknwon" target="_blank">无闻</a> 对域名 <a href="https://gorm.cn" target="_blank">gorm.cn</a> 的捐赠<br>
      <a href="http://beian.miit.gov.cn/" target="_blank" data-spm-anchor-id="a3c00.7621333.7y9jhqsfz.112">浙ICP备2020033190号-1</a><br>
      </div>

      <script>
        if (window.location.hostname.includes("gorm.cn")) {
          document.getElementById("gorm.cn").style.display = 'block';
        }
      </script>
    </div>
    <div id="footer-links">
      <a href="https://twitter.com/zhangjinzhu" class="footer-link" target="_blank"><i class="fa fa-twitter"></i></a>
      <a href="https://github.com/go-gorm/gorm" class="footer-link" target="_blank"><i class="fa fa-github-alt"></i></a>
    </div>
  </div>
</footer>

  </div>
  <div id="mobile-nav-dimmer"></div>
  <nav id="mobile-nav">
  <div id="mobile-nav-inner">
    <ul id="mobile-nav-list">
      <li class="mobile-nav-item">
        <a href="/" class="mobile-nav-link" rel="external" target="_blank"><i class="fa fa-home"></i>Home</a>
      </li>
      <a href="/docs/" class="mobile-nav-link"><i class="fa fa-book"></i>Docs</a><a href="/community.html" class="mobile-nav-link"><i class="fab fa-slack"></i>Community</a><a href="https://pkg.go.dev/gorm.io/gorm" class="mobile-nav-link" target="_blank"><i class="fa fa-cogs"></i>API</a><a href="/contribute.html" class="mobile-nav-link"><i class="fa fa-rocket"></i>Contribute</a>
    </ul>
    
      <strong class="mobile-nav-title">Getting Started</strong><a href="index.html" class="mobile-nav-link">Overview</a><strong class="mobile-nav-title">Dao Generator</strong><a href="dao.html" class="mobile-nav-link">Overview</a><a href="create.html" class="mobile-nav-link">Create</a><a href="update.html" class="mobile-nav-link">Update</a><a href="query.html" class="mobile-nav-link">Query</a><a href="delete.html" class="mobile-nav-link">Delete</a><a href="associations.html" class="mobile-nav-link">Associations</a><strong class="mobile-nav-title">Type-Safe Compiled SQL</strong><a href="type_safe_sql.html" class="mobile-nav-link">Overview</a><a href="dynamic_sql.html" class="mobile-nav-link current">Dynamic SQL</a><strong class="mobile-nav-title">Database To Structs</strong><a href="database_to_structs.html" class="mobile-nav-link">Overview</a><a href="fields.html" class="mobile-nav-link">Fields</a><a href="methods.html" class="mobile-nav-link">Methods</a><strong class="mobile-nav-title">Advanced Topics</strong><a href="clause.html" class="mobile-nav-link">GORM Clause</a><a href="transaction.html" class="mobile-nav-link">Transaction</a><a href="plugins.html" class="mobile-nav-link">GORM Plugins</a>
    
  </div>
  <div id="mobile-lang-select-wrap">
    <span id="mobile-lang-select-label"><i class="fa fa-globe"></i><span>English</span></span>
    <select id="mobile-lang-select" data-canonical="">
      
        <option value="en" selected>English</option>
      
        <option value="zh_CN">简体中文</option>
      
        <option value="de_DE">Deutsch</option>
      
        <option value="es_ES">Español</option>
      
        <option value="id_ID">bahasa Indonesia</option>
      
        <option value="it_IT">Italiano</option>
      
        <option value="ja_JP">日本語</option>
      
        <option value="ru_RU">Русский</option>
      
        <option value="fr_FR">French</option>
      
        <option value="ko_KR">한국어</option>
      
    </select>
  </div>
</nav>

  <!-- Scripts -->
<!-- build:js build/js/main.js -->

<script src="/js/lang_select.js"></script>


<script src="/js/toc.js"></script>


<script src="/js/mobile_nav.js"></script>


<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha256-4+XzXVhsDmqanXGHaHvgh1gMQKX40OUvDEBTu8JcmNs=" crossorigin="anonymous"></script>

<script src="/js/code_expander.js"></script>

<!-- endbuild -->

<!-- Algolia -->

<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.js"></script>
<script type="text/javascript">
document.getElementById('search-input-wrap').classList.add('on');
docsearch({
 apiKey: '442683d88a109de42c6d01bb0c7c4cec',
 indexName: 'gorm',
 inputSelector: '#search-input'
});
</script>



<!-- Google Tag Manager (noscript) -->
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-WSNPD75"
height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<!-- End Google Tag Manager (noscript) -->


</body>
</html>
